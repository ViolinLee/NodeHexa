本章节提供常见问题的故障排除指南，帮助您快速定位和解决问题。

#  12.1 硬件问题

##  12.1.1 舵机不响应

**症状：**
- 舵机不运动
- 只有部分舵机响应
- 舵机运动异常或抖动

**可能原因和解决方案：**

**1. 电源问题**
- **检查：** 电池电压是否正常（应大于6.4V）
- **解决：** 充电或更换电池
- **检查：** 电源连接是否牢固
- **解决：** 检查并重新连接电源线

**2. I2C通信问题**
- **检查：** PCA9685驱动板是否正常连接
- **解决：** 检查I2C线缆连接（SDA/SCL）
- **检查：** I2C地址是否正确（0x40和0x41）
- **解决：** 确认左侧驱动板已设置地址为0x41

**3. 舵机连接问题**
- **检查：** 舵机线缆是否连接正确
- **解决：** 检查并重新连接舵机线缆
- **检查：** 舵机是否损坏
- **解决：** 更换损坏的舵机

**4. 校准问题**
- **检查：** 校准数据是否正确
- **解决：** 重新校准舵机（参考第8.2节）

**调试步骤：**

1. 检查串口输出，查看是否有错误信息
2. 使用万用表检查电源电压
3. 检查I2C通信（可以使用I2C扫描工具）
4. 逐个测试舵机，找出问题舵机

##  12.1.2 电池电压异常

**症状：**
- LED指示灯闪烁（低电压警告）
- 机器人运动不稳定
- 突然停止工作

**可能原因和解决方案：**

**1. 电池电量不足**
- **检查：** 电池电压是否低于6.4V
- **解决：** 及时充电或更换电池
- **提示：** 低电压警告时建议停止使用

**2. 电池老化**
- **检查：** 电池容量是否下降
- **解决：** 更换新电池
- **检查：** 电池内阻是否增大
- **解决：** 使用高质量电池

**3. 电路问题**
- **检查：** 分压电路是否正常
- **解决：** 检查100kΩ和47kΩ电阻
- **检查：** ADC引脚连接是否正常
- **解决：** 检查GPIO34连接

**调试步骤：**

1. 启用`DEBUG_ADC_MONITOR`查看ADC值
2. 使用万用表直接测量电池电压
3. 检查分压电路电阻值
4. 验证ADC计算是否正确

**预防措施：**

- 定期检查电池电压
- 避免过度放电
- 使用带有保护板的锂电池
- 充电时断开机器人电源

##  12.1.3 WiFi连接失败

**症状：**
- 无法找到WiFi热点
- 无法连接WiFi热点
- 连接后无法访问Web界面

**可能原因和解决方案：**

**1. ESP32未启动**
- **检查：** 串口是否有启动信息
- **解决：** 检查电源连接，重启ESP32
- **检查：** 固件是否正常
- **解决：** 重新烧录固件

**2. WiFi密码错误**
- **检查：** 密码是否正确（默认：roboticscv666）
- **解决：** 确认密码，重新连接

**3. 距离太远**
- **检查：** 设备是否在WiFi覆盖范围内
- **解决：** 靠近机器人，或重启WiFi热点

**4. 连接数限制**
- **检查：** 是否超过最大连接数（4个）
- **解决：** 断开其他设备连接

**5. 网络配置问题**
- **检查：** IP地址是否正确（192.168.4.1）
- **解决：** 使用自动获取IP，或手动设置IP

**调试步骤：**

1. 检查串口输出，确认WiFi热点已创建
2. 确认SSID和密码正确
3. 检查设备WiFi设置
4. 尝试重启机器人和设备

**常见问题：**

- **手机无法连接：** 某些手机可能需要手动输入IP地址
- **电脑无法连接：** 检查防火墙设置
- **连接后无网络：** 正常现象，WiFi热点不提供互联网访问

#  12.2 软件问题

##  12.2.1 编译错误

**常见编译错误：**

**1. 依赖库缺失**
- **错误：** `fatal error: xxx.h: No such file or directory`
- **解决：** PlatformIO会自动下载依赖，等待完成或手动安装

**2. 语法错误**
- **错误：** `error: expected ';' before '}' token`
- **解决：** 检查代码语法，修复错误

**3. 内存不足**
- **错误：** `region 'IRAM' overflowed`
- **解决：** 优化代码，减少内存使用

**4. 平台配置错误**
- **错误：** `Unknown board ID`
- **解决：** 检查`platformio.ini`配置

**调试步骤：**

1. 查看完整错误信息
2. 检查错误位置和上下文
3. 搜索错误信息，查找解决方案
4. 检查代码是否有拼写错误

**预防措施：**

- 定期备份代码
- 使用版本控制（Git）
- 小步迭代，每次修改后编译测试
- 参考项目示例代码

##  12.2.2 运行异常

**常见运行异常：**

**1. 程序崩溃（重启循环）**
- **症状：** ESP32不断重启
- **可能原因：**
  - 内存溢出
  - 空指针访问
  - 栈溢出
  - Watchdog超时
- **解决：**
  - 检查内存使用
  - 检查指针有效性
  - 增加栈大小
  - 检查长时间阻塞操作

**2. 运动异常**
- **症状：** 机器人运动不正确或不流畅
- **可能原因：**
  - 校准数据错误
  - 轨迹点超出范围
  - 逆运动学计算错误
- **解决：**
  - 重新校准
  - 检查轨迹点
  - 验证运动学计算

**3. 通信异常**
- **症状：** WebSocket或串口通信失败
- **可能原因：**
  - JSON格式错误
  - 缓冲区溢出
  - 网络连接问题
- **解决：**
  - 检查JSON格式
  - 增加缓冲区大小
  - 检查网络连接

**调试步骤：**

1. 启用串口调试输出
2. 查看错误日志
3. 使用调试工具（GDB）
4. 逐步排查问题

##  12.2.3 通信故障

**WebSocket通信问题：**

**症状：** 无法连接或消息无响应

**可能原因：**
- 网络连接问题
- WebSocket服务器未启动
- 消息格式错误

**解决：**
- 检查WiFi连接
- 检查服务器状态
- 验证JSON格式

**串口通信问题：**

**症状：** 串口无响应或数据错误

**可能原因：**
- 串口配置错误（波特率）
- 帧格式错误
- 硬件连接问题

**解决：**
- 检查波特率（115200）
- 确认帧格式（`$<JSON>\n`）
- 检查硬件连接

**HTTP通信问题：**

**症状：** 无法访问Web页面

**可能原因：**
- 服务器未启动
- IP地址错误
- 防火墙阻止

**解决：**
- 检查服务器状态
- 确认IP地址
- 检查防火墙设置

#  12.3 机械问题

**常见机械问题：**

**1. 关节卡死**
- **症状：** 关节无法运动
- **原因：** 机械干涉、异物卡住
- **解决：** 检查机械结构，清除异物

**2. 运动不流畅**
- **症状：** 运动有卡顿或抖动
- **原因：** 机械磨损、润滑不足
- **解决：** 添加润滑，检查磨损

**3. 结构松动**
- **症状：** 部件松动或脱落
- **原因：** 螺丝松动、连接件损坏
- **解决：** 紧固螺丝，更换损坏部件

**4. 安装错误**
- **症状：** 腿安装位置错误
- **原因：** 组装错误
- **解决：** 参考组装教程重新组装

**检查清单：**

- [ ] 所有螺丝已紧固
- [ ] 舵机安装正确
- [ ] 腿部结构完整
- [ ] 无机械干涉
- [ ] 运动范围正常

**预防措施：**

- 定期检查机械结构
- 保持清洁，避免异物
- 适当润滑活动部件
- 避免过度负载
- 按照规范使用

---
