本章节将指导您从零开始完成NodeHexa六足机器人的组装、固件烧录和首次使用。如果您已购买套件，建议参考官方复刻教程进行组装。

#  7.1 硬件组装

**组装说明：**

硬件组装涉及腿部组装、机身组装、电路连接等多个步骤。详细的组装教程请参考：

**官方复刻教程：**
1. [六足机器人NodeHexa复刻教程（一）器材准备篇](https://mp.weixin.qq.com/s/QebT1wd3da98jmFbrUHNdA)
2. [六足机器人NodeHexa复刻教程（二）腿部组装篇](https://mp.weixin.qq.com/s/x1spemwsdwfix2QXKvCDqA)
3. [六足机器人NodeHexa复刻教程（三）机身组装篇](https://mp.weixin.qq.com/s/Z3uXM__K4puC-hbytVeSNw)

**组装后检查清单：**

完成组装后，请确认以下事项：

- [ ] 所有18个舵机已正确安装并连接
- [ ] 左右两侧PCA9685驱动板I2C地址已正确配置（0x40和0x41）
- [ ] ESP32主控板已正确安装
- [ ] 所有电源连接正确
- [ ] 电池已安装（或外接电源已连接）
- [ ] USB数据线已连接（用于固件烧录）

**重要提示：**

- 左侧PCA9685驱动板需要焊接SJ1跳帽以设置I2C地址为0x41
- 确保舵机线缆连接正确，避免接触不良
- 首次使用前请检查所有机械连接是否牢固

**TODO：** 需要补充详细的硬件组装步骤和连接图

#  7.2 固件编译

**前提条件：**

在开始编译之前，请确保：
1. 已完成第5章"环境配置"中的所有步骤
2. Visual Studio Code和PlatformIO插件已安装
3. 项目代码已下载到本地

**编译步骤：**

**步骤1：打开项目**

1. 打开Visual Studio Code
2. 选择 `文件` → `打开文件夹`
3. 选择NodeHexa项目根目录（包含`platformio.ini`的目录）

**步骤2：编译固件**

PlatformIO会自动检测项目配置。编译方法：

**方法1：使用PlatformIO工具栏**
1. 点击PlatformIO工具栏中的`✓`（编译）按钮
2. 或使用快捷键（Windows/Linux: `Ctrl+Alt+B`，macOS: `Cmd+Alt+B`）

**方法2：使用终端命令**
```bash
cd firmware
pio run
```

**编译输出：**

编译成功后，您会看到类似以下输出：
```
Building .pio\build\nodemcu-32s\firmware.bin
...
Memory Usage -> http://bit.ly/pio-memory-usage
RAM:   [====      ]  40.0% (used 209124 bytes from 524288 bytes)
Flash: [====      ]  40.0% (used 1048576 bytes from 2621440 bytes)
======================== [SUCCESS] Took 25.34 seconds
```

**编译产物位置：**

编译完成后，固件文件位于：
```
firmware/.pio/build/nodemcu-32s/
├── bootloader.bin      # 引导加载程序
├── partitions.bin       # 分区表
├── firmware.bin         # 主应用程序固件
└── ...
```

**常见编译错误：**

1. **依赖库缺失：** PlatformIO会自动下载依赖库，首次编译可能需要较长时间
2. **Python环境问题：** 如果pathTool相关功能报错，检查Python环境
3. **内存不足：** 确保有足够的磁盘空间（至少2GB）

**构建SPIFFS文件系统：**

SPIFFS文件系统镜像需要单独构建：

**方法1：使用PlatformIO工具栏**
1. 点击PlatformIO工具栏中的`PlatformIO: Build Filesystem Image`按钮

**方法2：使用终端命令**
```bash
cd firmware
pio run --target buildfs
```

构建完成后，SPIFFS镜像位于：
```
firmware/.pio/build/nodemcu-32s/spiffs.bin
```

**TODO：** 需要补充详细的编译错误排查步骤

#  7.3 固件烧录

**前提条件：**

- 固件已成功编译（见7.2节）
- ESP32已通过USB连接到电脑
- 电脑能识别到串口设备（见第6章器材准备）

**烧录方法：**

##  方法1：使用PlatformIO（推荐）

**步骤1：检查串口**

确认`platformio.ini`中的串口配置：

```ini
upload_port = COM[3]  # Windows示例
monitor_port = COM[3]
```

**注意：** 
- Windows系统：`COM[3]`或具体端口号如`COM3`
- Linux系统：`/dev/ttyUSB0`或`/dev/ttyACM0`
- macOS系统：`/dev/cu.usbserial-*`或`/dev/cu.SLAB_USBtoUART`

PlatformIO会自动检测串口，也可以不指定`upload_port`，让系统自动选择。

**步骤2：上传固件**

**使用PlatformIO工具栏：**
1. 点击PlatformIO工具栏中的`→`（上传）按钮
2. 或使用快捷键（Windows/Linux: `Ctrl+Alt+U`，macOS: `Cmd+Alt+U`）

**使用终端命令：**
```bash
cd firmware
pio run --target upload
```

**步骤3：上传文件系统**

上传SPIFFS文件系统镜像：

**使用PlatformIO工具栏：**
1. 点击PlatformIO工具栏中的`PlatformIO: Upload Filesystem Image`按钮

**使用终端命令：**
```bash
cd firmware
pio run --target uploadfs
```

**烧录过程：**

上传过程中，您会看到类似以下输出：
```
Connecting...
Chip is ESP32-D0WDQ6 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse
Uploading...
Writing at 0x00010000... (100%)
...
```

**注意事项：**
- 如果上传失败，尝试按住ESP32的BOOT按钮后重新上传
- 确保使用支持数据传输的USB数据线
- 上传过程中不要断开USB连接

##  方法2：使用ESP32 Flash Download Tool

**适用场景：**
- PlatformIO上传失败
- 需要批量烧录
- 需要手动控制烧录过程

**步骤1：下载工具**

下载并安装 [ESP32 Flash Download Tool](https://www.espressif.com/en/support/download/other-tools)

**步骤2：准备文件**

从编译输出目录复制以下文件：
- `bootloader.bin`
- `partitions.bin`
- `firmware.bin`
- `spiffs.bin`（如果已构建）

**步骤3：配置烧录工具**

1. 打开`flash_download_tool`
2. 选择芯片类型：**ESP32**
3. 选择工作模式：**develop**

**步骤4：添加文件**

在烧录工具中添加以下文件：

| 文件路径 | 烧录地址 | 文件大小 |
|----------|----------|----------|
| `bootloader.bin` | 0x1000 | 自动检测 |
| `partitions.bin` | 0x8000 | 自动检测 |
| `firmware.bin` | 0x10000 | 自动检测 |
| `spiffs.bin` | 0x290000 | 自动检测 |

**步骤5：烧录设置**

- **波特率：** 115200（推荐）
- **Flash模式：** DIO
- **Flash大小：** 4MB (32Mbit)
- **Flash频率：** 40MHz

**步骤6：开始烧录**

1. 选择正确的串口（COM端口）
2. 点击**START**开始烧录
3. 等待烧录完成（进度条显示100%）

**烧录验证：**

烧录完成后，可以打开串口监视器查看启动信息（见7.4节）。

**TODO：** 需要补充详细的烧录故障排除步骤

#  7.4 首次启动

**启动步骤：**

**步骤1：上电**

1. 确保电池已安装并充满电（或外接电源已连接）
2. 打开电源开关（注意检查正负极，严禁反接，否则电路板立马烧毁！）
3. 或者通过USB供电（不推荐长时间使用，仅用于调试）

**步骤2：观察启动过程**

**串口输出：**

通过PlatformIO串口监视器查看启动信息：

**打开串口监视器：**
- PlatformIO工具栏：点击`🔌`（串口监视器）按钮
- 或使用快捷键（Windows/Linux: `Ctrl+Alt+S`，macOS: `Cmd+Alt+S`）

**启动日志示例：**

```
Starting...
UART2 initialized: 115200 baud (GPIO16-RX, GPIO17-TX)
NodeHexa Ready! AP IP address: 192.168.4.1
HTTP server started
Hexapod init done.
Started, mode=0
```

**步骤3：检查WiFi热点**

启动成功后，ESP32会自动创建WiFi热点：

- **SSID：** `NodeHexa`
- **密码：** `roboticscv666`
- **IP地址：** `192.168.4.1`

**步骤4：连接WiFi**

使用手机或电脑连接WiFi热点：

1. 打开WiFi设置
2. 搜索并连接到`NodeHexa`网络
3. 输入密码：`roboticscv666`
4. 连接成功后，设备会获得`192.168.4.x`的IP地址

**启动状态检查：**

**正常启动标志：**
- ✅ 串口输出显示"NodeHexa Ready!"
- ✅ 能够连接WiFi热点
- ✅ 能够访问Web控制界面
- ✅ LED指示灯正常（无低电压警告）

**异常情况：**

如果启动异常，请检查：
- 串口输出是否有错误信息
- WiFi热点是否创建成功
- 电池电压是否正常（LED是否闪烁）

**TODO：** 需要补充详细的启动故障排除步骤

#  7.5 基本操作

**步骤1：访问Web控制界面**

1. 确保设备已连接到`NodeHexa` WiFi热点
2. 打开Web浏览器（Chrome、Firefox、Edge等）
3. 访问：`http://192.168.4.1`

**步骤2：进行舵机校准（重要）**

首次使用前，必须进行舵机校准：

1. 访问校准页面：`http://192.168.4.1/calibration`
2. 按照页面提示进行校准操作
3. 校准完成后保存数据

**详细校准步骤：** 请参考第8章"使用指南"中的8.2节"舵机校准"

**步骤3：测试基本运动**

校准完成后，返回主控制页面进行测试：

1. **待机模式：** 确保机器人处于待机状态
2. **前进测试：** 点击前进按钮，观察机器人运动
3. **速度调节：** 尝试调整速度等级
4. **其他动作：** 测试转向、侧移等动作

**基本操作提示：**

- **安全第一：** 在开阔、安全的环境中进行测试
- **逐步测试：** 先测试慢速运动，确认正常后再提高速度
- **观察状态：** 注意观察机器人运动是否流畅，是否有异常
- **及时停止：** 发现异常立即停止，检查问题

**下一步：**

完成基本操作后，您可以：
- 阅读第8章"使用指南"了解详细功能
- 阅读第9章"通信协议"了解如何通过程序控制
- 阅读第10章"动作组扩展开发"学习如何添加自定义动作

**TODO：** 需要补充常见问题的快速解决方案

---
