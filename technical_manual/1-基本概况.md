# 1.1 项目简介

**项目名称：** NodeHexa

**项目性质：** 开源六足机器人项目

**项目描述：**

NodeHexa是一个基于ESP32开发板（[NodeMCU-32S](https://item.taobao.com/item.htm?abbucket=17&id=978660618653)）的开源六足机器人项目。该项目集成了运动控制算法、Web界面控制和实时校准功能，为机器人爱好者和研究人员提供了一个完整的六足机器人解决方案。

**核心定位：**

- **教育用途：** 提供完整的开源代码和文档，便于学习六足机器人原理
- **商用产品：** 已在电商平台销售，提供完整的硬件套件
- **二次开发：** 支持用户自定义动作组和功能扩展

**项目来源：**

本项目基于以下开源项目二次开发：
- [hexapod-v2-7697](https://github.com/SmallpTsai/hexapod-v2-7697)
- [PiHexa18](https://github.com/ViolinLee/PiHexa18)

**项目作者：**

- **GitHub：** [@ViolinLee](https://github.com/ViolinLee)
- **B站：** [@智造师_RoboticsCV](https://space.bilibili.com/智造师_RoboticsCV)
- **微信公众号：** RoboticsCV

**开源协议：** GPL-3.0

# 1.2 技术特点

## 1.2.1 硬件平台

**主控制器：**
- ESP32（NodeMCU-32S开发板）
- 双核处理器，520KB SRAM
- 4MB Flash存储

**执行机构：**
- 18个舵机（6条腿 × 3个关节/腿）
- 2块PCA9685 PWM驱动板（I2C通信）

**通信接口：**
- WiFi（AP模式，支持Web控制）
- UART2串口（外部控制接口）
- I2C（舵机驱动板通信）

## 1.2.2 软件架构

**开发框架：**
- PlatformIO + Arduino框架
- C++语言开发

**核心算法：**
- 正运动学和逆运动学计算
- 基于预定义动作组的步态控制
- 实时插值和平滑过渡

**通信协议：**
- WebSocket实时控制
- HTTP Web界面
- JSON格式数据交换

## 1.2.3 功能特性

**控制方式：**
- **Web界面控制：** 通过浏览器实时控制机器人运动
- **串口通信：** 支持UART2串口指令控制，可用于调试和外接上位机（如小智AI语音拓展板）
- **WebSocket通信：** 低延迟的实时数据传输

**运动模式：**
- **基础移动：** 前进、后退、左转、右转
- **侧向移动：** 左移、右移
- **姿态控制：** X/Y/Z轴旋转、扭转动作
- **特殊动作：** 攀爬、快速前进
- **速度控制：** 支持4个速度档位（0.25x、0.33x、0.5x、1.0x）

**校准功能：**
- **实时校准：** 通过Web界面进行舵机角度可视化校准
- **参数保存：** 校准数据自动保存到Flash存储（SPIFFS文件系统）

**安全保护：**
- **电池监测：** 实时监控电池电压
- **低电压保护：** 自动LED警告：电压低于设定阈值闪烁（默认配置阈值为6.4V）

**扩展性：**
- **动作组扩展：** 支持通过Python脚本生成自定义动作组
- **二次开发：** 模块化设计，便于添加新功能

# 1.3 系统架构概述

## 1.3.1 整体架构

```
┌─────────────────────────────────────────┐
│         用户控制层                      │
│  (Web界面 / 串口 / WebSocket)          │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│         通信处理层                      │
│  (WiFi AP / HTTP / WebSocket / UART)   │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│         控制逻辑层                      │
│  (HexapodClass / Movement / Leg)       │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│         执行层                          │
│  (Servo / PCA9685 / 18个舵机)          │
└─────────────────────────────────────────┘
```

## 1.3.2 模块划分

**主程序模块（main.cpp）：**
- 系统初始化（WiFi、SPIFFS、I2C、串口）
- Web服务器和WebSocket服务
- FreeRTOS任务管理（电池监测、LED控制、串口处理）
- 主循环（运动模式循环、校准模式循环）

**六足控制模块（hexapod.h/cpp）：**
- 六足机器人核心控制类
- 管理6条腿的实例
- 运动处理接口
- 速度控制接口
- 校准数据管理

**腿部控制模块（leg.h/cpp）：**
- 单条腿的控制类
- 正运动学和逆运动学计算
- 世界坐标系与局部坐标系转换
- 足端位置控制

**动作控制模块（movement.h/cpp, movements.cpp）：**
- 动作执行类
- 动作组切换和插值过渡
- 速度控制
- 动作表管理（12种预定义运动模式）

**舵机控制模块（servo.h/cpp）：**
- 单个舵机的控制类
- 角度设置（-60°~60°）
- 校准偏移量管理
- PCA9685 PWM驱动接口

**轨迹生成工具（pathTool）：**
- Python脚本生成足端轨迹
- 轨迹验证（逆运动学检查）
- 生成C++格式的动作表头文件

## 1.3.3 数据流

**运动控制流程：**

```
用户指令 → WebSocket/串口接收 → JSON解析 → 运动模式选择
    ↓
动作组查找 → 轨迹点索引 → 插值计算 → 逆运动学
    ↓
关节角度计算 → 舵机PWM输出 → 机器人运动
```

**校准流程：**

```
Web界面 → HTTP POST → JSON解析 → 校准数据更新
    ↓
实时测试 → 用户确认 → 保存到Flash → 重启应用
```

# 1.4 版本信息

**固件版本：** 1.1.0

**版本定义位置：** `firmware/platformio.ini`
```ini
build_flags = -D FIRMWARE_VERSION="1.1.0"
```

**支持的硬件平台：**
- ESP32（NodeMCU-32S开发板）
- PlatformIO平台：espressif32
- Arduino框架

**运动模式数量：** 12种

| 模式编号 | 模式名称 | 说明 |
|---------|---------|------|
| 0 | MOVEMENT_STANDBY | 待机 |
| 1 | MOVEMENT_FORWARD | 前进 |
| 2 | MOVEMENT_FORWARDFAST | 快速前进 |
| 3 | MOVEMENT_BACKWARD | 后退 |
| 4 | MOVEMENT_TURNLEFT | 左转 |
| 5 | MOVEMENT_TURNRIGHT | 右转 |
| 6 | MOVEMENT_SHIFTLEFT | 左移 |
| 7 | MOVEMENT_SHIFTRIGHT | 右移 |
| 8 | MOVEMENT_CLIMB | 攀爬 |
| 9 | MOVEMENT_ROTATEX | X轴旋转 |
| 10 | MOVEMENT_ROTATEY | Y轴旋转 |
| 11 | MOVEMENT_ROTATEZ | Z轴旋转 |
| 12 | MOVEMENT_TWIST | 扭转 |

**主要依赖库版本：**
- Adafruit PWM Servo Driver Library: ^3.0.2
- ESPAsyncWebServer: （版本信息待确认）
- ArduinoJson: （版本信息待确认）

---
