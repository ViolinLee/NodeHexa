  5. 环境配置

本章节详细介绍如何搭建NodeHexa六足机器人的开发环境，包括IDE安装、开发工具配置和依赖库管理。

#  5.1 Visual Studio Code (VSCode)安装

**VSCode简介：**

Visual Studio Code是一个轻量级但功能强大的源代码编辑器，支持多种编程语言和丰富的扩展插件。

**安装步骤：**

**Windows系统：**
1. 访问VSCode官网：https://code.visualstudio.com/
2. 下载Windows版本安装包（64位或32位）
3. 运行安装程序，按照提示完成安装
4. 建议安装时勾选"添加到PATH"和"添加到桌面"

**macOS系统：**
1. 访问VSCode官网下载macOS版本
2. 下载`.dmg`文件并打开
3. 将VSCode拖拽到Applications文件夹
4. 首次运行时，系统可能提示安全警告，需要在"系统偏好设置"中允许运行

**Linux系统：**
1. 访问VSCode官网下载对应版本（.deb或.rpm）
2. 使用包管理器安装：
   ```bash
   # Ubuntu/Debian
   sudo dpkg -i code_*.deb
   sudo apt-get install -f
   
   # Fedora/RHEL
   sudo rpm -ivh code_*.rpm
   ```

**验证安装：**

打开VSCode，在菜单栏选择"帮助" → "关于"，确认版本信息。推荐使用最新稳定版。

#  5.2 PlatformIO插件安装

**PlatformIO简介：**

PlatformIO是一个跨平台的嵌入式开发工具链，支持多种微控制器和开发板，与VSCode集成良好。

**安装步骤：**

**方法1：通过VSCode扩展市场安装（推荐）**

1. 打开VSCode
2. 点击左侧扩展图标（或使用快捷键 `Ctrl+Shift+X` / `Cmd+Shift+X`）
3. 搜索"PlatformIO IDE"
4. 点击"安装"按钮
5. 等待安装完成（首次安装可能需要几分钟）
6. 安装完成后，VSCode会提示重启，点击"重新加载"

**方法2：手动安装**

如果扩展市场安装失败，可以：
1. 访问PlatformIO官网：https://platformio.org/
2. 下载PlatformIO Core
3. 按照官方文档手动安装

**验证安装：**

安装完成后，VSCode左侧会出现PlatformIO图标（蚂蚁图标）。点击该图标，应该能看到PlatformIO的欢迎页面。

**首次配置：**

1. PlatformIO会自动下载必要的工具链（首次启动可能需要较长时间）
2. 确保网络连接正常，允许PlatformIO访问网络
3. 等待工具链下载完成

**常见问题：**

- **安装失败：** 检查网络连接，可能需要配置代理
- **下载慢：** PlatformIO服务器可能在国外，建议使用稳定的网络连接
- **权限问题：** Linux/macOS可能需要管理员权限

#  5.3 开发工具推荐

**必需工具：**

1. **Visual Studio Code + PlatformIO插件**
   - 主要开发环境
   - 支持代码补全、调试、固件烧录

2. **串口监视器**
   - PlatformIO内置（推荐）
   - 或使用PuTTY、串口助手等第三方工具

3. **Git（可选但推荐）**
   - 版本控制
   - 下载地址：https://git-scm.com/

**可选工具：**

1. **Python 3.x**
   - 用于运行pathTool轨迹生成工具
   - 下载地址：https://www.python.org/

2. **NumPy库**
   - pathTool依赖库
   - 安装命令：`pip install numpy`

3. **串口调试工具**
   - PuTTY（Windows）
   - Screen（Linux/macOS）
   - 串口助手等

4. **文本编辑器**
   - 用于查看和编辑配置文件
   - VSCode已足够

**开发流程推荐：**

1. 使用VSCode编辑代码
2. 使用PlatformIO编译和烧录
3. 使用PlatformIO串口监视器调试
4. 使用Git管理代码版本

#  5.4 依赖库安装

**依赖库说明：**

NodeHexa项目使用PlatformIO的库管理系统，所有依赖库在`platformio.ini`中定义，PlatformIO会自动下载和管理。

**主要依赖库：**

从`platformio.ini`中可以看到以下依赖：

```ini
lib_deps = 
  adafruit/Adafruit PWM Servo Driver Library@^3.0.2
  SPI
```

**自动安装：**

PlatformIO会在首次编译时自动下载所有依赖库，无需手动安装。

**手动安装（如果需要）：**

如果自动安装失败，可以手动安装：

1. 打开PlatformIO主页
2. 点击"Libraries"
3. 搜索库名称
4. 选择版本并安装

**本地库：**

项目还包含一些本地库（在`lib/`目录下）：
- `ArduinoJson`：JSON处理库
- `ESPAsyncWebServer`：异步Web服务器库
- `hal`：硬件抽象层（PCA9685驱动）

这些库已包含在项目中，无需额外安装。

**依赖库版本：**

- **Adafruit PWM Servo Driver Library：** ^3.0.2（3.0.2或更高版本）
- **ArduinoJson：** 项目内包含的版本
- **ESPAsyncWebServer：** 项目内包含的版本

**更新依赖库：**

如果需要更新依赖库：

1. 修改`platformio.ini`中的版本号
2. 重新编译项目
3. PlatformIO会自动下载新版本

**常见问题：**

- **下载失败：** 检查网络连接，可能需要配置代理
- **版本冲突：** 确保版本号正确，参考项目配置
- **库路径错误：** 确保`platformio.ini`配置正确

#  5.5 编译环境配置

**PlatformIO配置：**

项目配置文件位于`firmware/platformio.ini`，包含以下关键配置：

```ini
[env:nodemcu-32s]
platform = espressif32
board = nodemcu-32s
framework = arduino
board_build.flash_mode = dio
upload_port = COM[3]  # Windows示例，Linux/macOS需要修改
monitor_port = COM[3]
monitor_speed = 115200
build_type = debug
build_flags = 
    -D FIRMWARE_VERSION="1.1.0"
```

**配置说明：**

1. **platform：** `espressif32` - ESP32平台
2. **board：** `nodemcu-32s` - NodeMCU-32S开发板
3. **framework：** `arduino` - Arduino框架
4. **flash_mode：** `dio` - Flash模式
5. **upload_port：** 串口端口号（需要根据实际设备修改）
6. **monitor_speed：** 115200 - 串口波特率

**串口配置：**

**Windows系统：**
- 串口通常为`COM3`、`COM4`等
- 可以在设备管理器中查看
- 配置示例：`upload_port = COM3`

**Linux系统：**
- 串口通常为`/dev/ttyUSB0`或`/dev/ttyACM0`
- 配置示例：`upload_port = /dev/ttyUSB0`
- 可能需要添加用户到dialout组：`sudo usermod -a -G dialout $USER`

**macOS系统：**
- 串口通常为`/dev/cu.usbserial-*`或`/dev/cu.SLAB_USBtoUART`
- 配置示例：`upload_port = /dev/cu.usbserial-1410`
- 使用`ls /dev/cu.*`查看可用串口

**自动检测串口：**

PlatformIO支持自动检测串口，可以不指定`upload_port`，让系统自动选择。

**编译选项：**

**build_flags：** 编译标志
- `-D FIRMWARE_VERSION="1.1.0"`：定义固件版本号

**build_type：** 编译类型
- `debug`：调试模式（包含调试信息）
- `release`：发布模式（优化代码）

**验证配置：**

1. 打开项目目录（`firmware`文件夹）
2. 在VSCode中打开PlatformIO主页
3. 点击"编译"按钮（或使用快捷键）
4. 查看编译输出，确认没有错误

**常见配置问题：**

1. **串口找不到：** 检查USB连接，确认驱动已安装
2. **编译失败：** 检查依赖库是否正确安装
3. **上传失败：** 检查串口配置和权限
4. **权限错误：** Linux/macOS可能需要sudo权限或添加用户到dialout组

**下一步：**

配置完成后，您可以：
1. 参考第7章"快速开始"进行首次编译和烧录
2. 参考第10章"动作组扩展开发"学习如何修改代码
3. 参考第11章"二次开发指南"进行深度定制

---
