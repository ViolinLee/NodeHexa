本章节提供技术参考信息，包括API参考、引脚定义、配置参数等。

#  14.1 API参考

##  14.1.1 HexapodClass API

**类定义：** `hexapod::HexapodClass`

**全局实例：** `hexapod::Hexapod`

**初始化：**

```cpp
void init(bool setting, bool isReset=false);
```
- `setting`: 是否为校准模式（true=校准模式，false=运动模式）
- `isReset`: 是否重置所有足端位置（默认false）

**运动控制：**

```cpp
void processMovement(MovementMode mode, int elapsed = 0);
```
- `mode`: 运动模式枚举
- `elapsed`: 距上次调用的时间（毫秒，默认0）

**速度控制：**

```cpp
void setMovementSpeed(float speed);
void setMovementSpeedLevel(SpeedLevel level);
float getMovementSpeed() const;
```
- `speed`: 速度倍数（0.25-1.0）
- `level`: 速度等级（SPEED_SLOWEST、SPEED_SLOW、SPEED_MEDIUM、SPEED_FAST）

**校准接口：**

```cpp
void calibrationSave();                                    // 保存校准数据到Flash
void calibrationGet(int legIndex, int partIndex, int& offset);  // 读取偏移量
void calibrationSet(int legIndex, int partIndex, int offset);    // 设置偏移量
void calibrationSet(CalibrationData& calibrationData);    // 批量设置
void calibrationTest(int legIndex, int partIndex, float angle);  // 测试单个舵机
void calibrationTestAllLeg(float angle);                  // 测试所有腿
void clearOffset();                                       // 清除所有偏移
void forceResetAllLegTippos();                           // 强制重置所有足端位置
```

##  14.1.2 Leg API

**类定义：** `hexapod::Leg`

**构造函数：**

```cpp
Leg(int legIndex);
```
- `legIndex`: 腿编号（0-5）

**坐标转换：**

```cpp
void translateToLocal(const Point3D& world, Point3D& local);
void translateToWorld(const Point3D& local, Point3D& world);
```

**足端控制：**

```cpp
void moveTip(const Point3D& to);                    // 世界坐标系
void moveTipLocal(const Point3D& to);               // 局部坐标系
const Point3D& getTipPosition(void);               // 获取世界坐标
const Point3D& getTipPositionLocal(void);          // 获取局部坐标
```

**关节控制：**

```cpp
void setJointAngle(float angle[3]);                 // 直接设置三个关节角度
```

**舵机访问：**

```cpp
Servo* get(int partIndex);                           // 获取指定关节的舵机对象
```

##  14.1.3 Movement API

**类定义：** `hexapod::Movement`

**构造函数：**

```cpp
Movement(MovementMode mode);
```

**模式控制：**

```cpp
void setMode(MovementMode newMode);                 // 切换运动模式
const Locations& next(int elapsed);                 // 获取下一帧的足端位置
```

**速度控制：**

```cpp
void setSpeed(float speed);                         // 设置速度倍数（0.25-1.0）
float getSpeed() const;                             // 获取当前速度
```

#  14.2 引脚定义

**引脚定义文件：** `firmware/include/PinDefines.h`

**当前引脚定义：**

```cpp
#define BAT_LED 25    // 电池低电压LED指示灯
#define BAT_ADC 34    // 电池电压ADC输入（仅输入引脚）
```

**I2C引脚：**

```cpp
// 在main.cpp中定义
Wire.setPins(21, 22);  // SDA=GPIO21, SCL=GPIO22
```

**UART2引脚：**

```cpp
// 在main.cpp中定义
Serial2.begin(115200, SERIAL_8N1, 16, 17);  // RX=GPIO16, TX=GPIO17
```

**UART0引脚（调试串口）：**

```cpp
// ESP32默认引脚
// TX: GPIO1
// RX: GPIO3
```

**可用引脚：**

ESP32 NodeMCU-32S开发板可用引脚：
- GPIO0-19, GPIO21-23, GPIO25-27, GPIO32-35
- 注意：GPIO34-35仅输入，GPIO6-11用于Flash，不建议使用

#  14.3 运动模式枚举

**定义位置：** `firmware/src/movement.h`

**枚举值：**

```cpp
enum MovementMode {
    MOVEMENT_STANDBY = 0,      // 待机
    MOVEMENT_FORWARD,          // 前进
    MOVEMENT_FORWARDFAST,      // 快速前进
    MOVEMENT_BACKWARD,         // 后退
    MOVEMENT_TURNLEFT,         // 左转
    MOVEMENT_TURNRIGHT,        // 右转
    MOVEMENT_SHIFTLEFT,        // 左移
    MOVEMENT_SHIFTRIGHT,       // 右移
    MOVEMENT_CLIMB,            // 攀爬
    MOVEMENT_ROTATEX,          // X轴旋转
    MOVEMENT_ROTATEY,          // Y轴旋转
    MOVEMENT_ROTATEZ,          // Z轴旋转
    MOVEMENT_TWIST,            // 扭转
    MOVEMENT_TOTAL,            // 总数（用于边界检查）
};
```

**模式编号对照表：**

| 编号 | 枚举值 | 说明 |
|------|--------|------|
| 0 | MOVEMENT_STANDBY | 待机 |
| 1 | MOVEMENT_FORWARD | 前进 |
| 2 | MOVEMENT_FORWARDFAST | 快速前进 |
| 3 | MOVEMENT_BACKWARD | 后退 |
| 4 | MOVEMENT_TURNLEFT | 左转 |
| 5 | MOVEMENT_TURNRIGHT | 右转 |
| 6 | MOVEMENT_SHIFTLEFT | 左移 |
| 7 | MOVEMENT_SHIFTRIGHT | 右移 |
| 8 | MOVEMENT_CLIMB | 攀爬 |
| 9 | MOVEMENT_ROTATEX | X轴旋转 |
| 10 | MOVEMENT_ROTATEY | Y轴旋转 |
| 11 | MOVEMENT_ROTATEZ | Z轴旋转 |
| 12 | MOVEMENT_TWIST | 扭转 |

#  14.4 配置参数说明

**配置文件：** `firmware/include/config.h`

**运动学参数（单位：mm）：**

```cpp
const float kLegMountLeftRightX = 29.87;    // 左右两侧腿的X坐标
const float kLegMountOtherX = 22.41;        // 其他4条腿的X坐标
const float kLegMountOtherY = 55.41;        // 其他4条腿的Y坐标

const float kLegRootToJoint1 = 20.75;       // 根关节到关节1的距离
const float kLegJoint1ToJoint2 = 28.0;     // 关节1到关节2的距离
const float kLegJoint2ToJoint3 = 42.6;      // 关节2到关节3的距离
const float kLegJoint3ToTip = 89.07;        // 关节3到足端的距离
```

**时序参数（单位：毫秒）：**

```cpp
const int movementInterval = 20;            // 主循环间隔时间
const int movementSwitchDuration = 150;     // 模式切换过渡时间
```

**速度控制参数：**

```cpp
const float defaultSpeed = 0.5;             // 默认速度倍数
const float minSpeed = 0.25;                // 最小速度倍数
const float maxSpeed = 1.0;                 // 最大速度倍数
```

**速度等级：**

```cpp
enum SpeedLevel {
    SPEED_SLOWEST = 0,   // 0.25x (极慢)
    SPEED_SLOW = 1,      // 0.33x (慢速)
    SPEED_MEDIUM = 2,    // 0.5x (中速, default)
    SPEED_FAST = 3       // 1.0x (快速)
};

const float speedLevelMultipliers[] = {0.25, 0.33, 0.5, 1.0};
```

**WiFi配置：**

在`main.cpp`中定义：
```cpp
const char* ssid = "NodeHexa";              // WiFi SSID
const char* password = "roboticscv666";      // WiFi密码
```

**串口配置：**

```cpp
#define UART2_BAUD_RATE 115200              // UART2波特率
```

**电池监测参数：**

```cpp
const float LOW_VOLTAGE_THRESHOLD = 6.4f;   // 低电压阈值（V）
const uint16_t ADC_THRESHOLD = ...;          // ADC阈值（自动计算）
```

#  14.5 参考资源

##  14.5.1 相关项目链接

**原始项目：**

- [hexapod-v2-7697](https://github.com/SmallpTsai/hexapod-v2-7697) - 原始六足机器人项目
- [PiHexa18](https://github.com/ViolinLee/PiHexa18) - 基于树莓派的六足机器人项目

**项目作者：**

- **GitHub：** [@ViolinLee](https://github.com/ViolinLee)
- **B站：** [@智造师_RoboticsCV](https://space.bilibili.com/智造师_RoboticsCV)
- **微信公众号：** RoboticsCV

**教程链接：**

1. [六足机器人NodeHexa复刻教程（一）器材准备篇](https://mp.weixin.qq.com/s/QebT1wd3da98jmFbrUHNdA)
2. [六足机器人NodeHexa复刻教程（二）腿部组装篇](https://mp.weixin.qq.com/s/x1spemwsdwfix2QXKvCDqA)
3. [六足机器人NodeHexa复刻教程（三）机身组装篇](https://mp.weixin.qq.com/s/Z3uXM__K4puC-hbytVeSNw)
4. [六足机器人NodeHexa复刻教程（四）编译烧录篇](https://mp.weixin.qq.com/s/InIxQt30JFU6OhD7m3k71Q)
5. [六足机器人NodeHexa复刻教程（五）功能调试篇](https://mp.weixin.qq.com/s/-viItGeh79Q6JDqvxl3oZQ)

##  14.5.2 技术文档

**ESP32相关：**

- [ESP32官方文档](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/)
- [Arduino ESP32文档](https://github.com/espressif/arduino-esp32)

**PlatformIO：**

- [PlatformIO官方文档](https://docs.platformio.org/)
- [PlatformIO ESP32教程](https://docs.platformio.org/en/latest/platforms/espressif32.html)

**库文档：**

- [ArduinoJson文档](https://arduinojson.org/)
- [ESPAsyncWebServer](https://github.com/me-no-dev/ESPAsyncWebServer)
- [Adafruit PWM Servo Driver Library](https://github.com/adafruit/Adafruit-PWM-Servo-Driver-Library)

**运动学参考：**

- [机器人运动学基础](https://en.wikipedia.org/wiki/Robot_kinematics)
- [六足机器人步态控制](https://en.wikipedia.org/wiki/Hexapod_robot)

##  14.5.3 社区支持

**GitHub：**

- 项目仓库：TODO（需要补充GitHub仓库地址）
- Issues：用于报告问题和建议
- Discussions：用于讨论和交流

**社区论坛：**

- TODO：需要补充社区论坛地址

**联系方式：**

- TODO：需要补充联系方式

#  14.6 更新日志

**版本 1.1.0（当前版本）**

**主要特性：**
- 基于ESP32的六足机器人控制系统
- Web界面控制
- WebSocket实时控制
- 串口控制接口
- 舵机校准功能
- 电池电压监测
- 12种预定义运动模式
- 速度控制（4个等级）

**已知问题：**
- TODO：需要补充已知问题列表

**后续计划：**
- TODO：需要补充后续开发计划

**版本历史：**
- TODO：需要补充完整版本历史

---
