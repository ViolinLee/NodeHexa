<!DOCTYPE HTML>
<html>
<head>
  <style>
    .title {
      text-align: center;
      position: relative;
    }
    .lang-switch {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background-color: #1E90FF;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 15px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px #999;
      transition: all 0.3s;
    }
    .lang-switch:hover {
      background-color: #0b7dda;
    }
    .lang-switch:active {
      box-shadow: 0 2px #666;
      transform: translateY(-48%);
    }
    .button { 
      display: inline-block;
      width: 130px; /* 所有按钮的统一宽度 */
      height: 50px; /* 所有按钮的统一高度 */
      line-height: 50px; /* 使文本垂直居中 */
      font-size: 20px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      outline: none;
      color: #fff;
      background-color: #1E90FF;
      border: none;
      border-radius: 10px;
      box-shadow: 0 9px #999;
    }
    .button:hover {background-color: #0b7dda}
    .button:active {
      background-color: #0b7dda;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }

    /* 移动按钮的颜色设置 */
    .button-move {
      background-color: #FF1493; /* 洋红色 */
    }
    .button-move:hover {background-color: #FF69B4}
    .button-move:active {
      background-color: #FF69B4;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }

    /* 姿态按钮的颜色设置 */
    .button-posture {
      background-color: #FFA500; /* 科技氛围的橙色 */
    }
    .button-posture:hover {background-color: #FFB347}
    .button-posture:active {
      background-color: #FFB347;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }

    /* 待机模式的颜色设置 */
    .button-standby {
      background-color: #3A3A3A; /* 大疆无人机灰 */
    }
    .button-standby:hover {background-color: #4A4A4A}
    .button-standby:active {
      background-color: #4A4A4A;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      justify-items: center;
      align-items: center;
      margin-top: 20px;
    }
    .grid-item-1 { grid-column: span 1; }
    .grid-item-2 { grid-column: span 2; }
    .grid-item-3 { grid-column: span 3; }
    .empty { visibility: hidden; }
    .empty-row { grid-column: span 3; height: 20px; }

    /* 速度控制区域样式 */
    .speed-control {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f5f5f5;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .speed-label {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }
    .speed-value {
      font-size: 24px;
      font-weight: bold;
      color: #1E90FF;
      text-align: center;
      margin: 10px 0;
    }
    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 15px;
      border-radius: 10px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .slider:hover {
      opacity: 1;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #1E90FF;
      cursor: pointer;
    }
    .slider::-moz-range-thumb {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #1E90FF;
      cursor: pointer;
      border: none;
    }
    .speed-markers {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 12px;
      color: #666;
    }

    /* Toggle开关样式 */
    .toggle-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 15px;
      gap: 10px;
    }
    .toggle-label {
      font-size: 14px;
      color: #666;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 24px;
    }
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }
    input:checked + .toggle-slider {
      background-color: #1E90FF;
    }
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* 页脚署名样式 */
    .footer {
      margin-top: 40px;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      border-radius: 10px 10px 0 0;
      box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
    }
    .footer-content {
      max-width: 600px;
      margin: 0 auto;
    }
    .footer-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .footer-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      font-size: 14px;
      padding: 8px 15px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      transition: all 0.3s;
    }
    .footer-link:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .footer-icon {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
  <h1 class="title">
    <span id="pageTitle">机器人控制</span>
    <button class="lang-switch" onclick="toggleLanguage()">English</button>
  </h1>

  <center><span align="center" style="text-align: center; display: inline-block;padding: 5px; font-size: 120%;font-weight: bold;"><a style="width:200px; height:50px;" href="/calibration">
    <button id="CALIBRATEPAGE" type="button" onclick="buttonclick(this);" style="width:200px; height: 30px; Text-align: center;">Calibration: Start | Save</button></a></span></center><br>

  <!-- 速度控制区域 -->
  <div class="speed-control">
    <div class="speed-label">运动速度控制</div>
    <div class="speed-value">速度: <span id="speedValue">0.50</span></div>
    <input type="range" min="0.3" max="1.0" step="0.05" value="0.5" class="slider" id="speedSlider">
    <div class="speed-markers">
      <span>慢速 (0.3)</span>
      <span>中速 (0.5)</span>
      <span>快速 (0.75)</span>
      <span>最快 (1.0)</span>
    </div>
    <div class="toggle-container">
      <span class="toggle-label">松开发送</span>
      <label class="switch">
        <input type="checkbox" id="realtimeToggle">
        <span class="toggle-slider"></span>
      </label>
      <span class="toggle-label">实时发送</span>
    </div>
  </div>
  
  <div class="grid-container">
    <button class="button button-posture grid-item-1" onclick="sendCommand(9)" data-zh="旋转X" data-en="RotateX">旋转X</button>
    <button class="button button-posture grid-item-1" onclick="sendCommand(10)" data-zh="旋转Y" data-en="RotateY">旋转Y</button>
    <button class="button button-posture grid-item-1" onclick="sendCommand(11)" data-zh="旋转Z" data-en="RotateZ">旋转Z</button>
    <button class="button button-posture grid-item-3" onclick="sendCommand(12)" data-zh="扭腰" data-en="Twist">扭腰</button>
    
    <div class="empty-row"></div>
    
    <button class="button grid-item-1" onclick="sendCommand(4)" data-zh="左转" data-en="TurnLeft">左转</button>
    <div class="empty grid-item-1"></div>
    <button class="button grid-item-1" onclick="sendCommand(5)" data-zh="右转" data-en="TurnRight">右转</button>
    
    <button class="button grid-item-1" onclick="sendCommand(2)" data-zh="快跑" data-en="Run">快跑</button>
    <button class="button button-move grid-item-1" onclick="sendCommand(1)" data-zh="前进" data-en="Forward">前进</button>
    <button class="button grid-item-1" onclick="sendCommand(8)" data-zh="爬行" data-en="Climb">爬行</button>
    
    <button class="button button-move grid-item-1" onclick="sendCommand(6)" data-zh="左移" data-en="ShiftLeft">左移</button>
    <button class="button button-standby grid-item-1" onclick="sendCommand(0)" data-zh="待机" data-en="Standby">待机</button>
    <button class="button button-move grid-item-1" onclick="sendCommand(7)" data-zh="右移" data-en="ShiftRight">右移</button>
    <button class="button button-move grid-item-3" onclick="sendCommand(3)" data-zh="后退" data-en="Backward">后退</button>
  </div>

  <!-- 页脚署名 -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-title" id="footerTitle">开源项目 · NodeHexa 六足机器人</div>
      <div class="footer-links">
        <a href="https://space.bilibili.com/智造师_RoboticsCV" target="_blank" class="footer-link" title="B站主页">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"/>
          </svg>
          <span id="bilibiliText">B站: 智造师_RoboticsCV</span>
        </a>
        <a href="https://github.com/ViolinLee" target="_blank" class="footer-link" title="GitHub主页">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
          </svg>
          <span id="githubText">GitHub: ViolinLee</span>
        </a>
        <span class="footer-link" title="微信公众号" style="cursor: default;">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982z"/>
          </svg>
          <span id="wechatText">公众号: RoboticsCV</span>
        </span>
      </div>
    </div>
  </footer>
  
  <script>
    var webSocketCarInputUrl = "ws:\/\/" + window.location.hostname + "/cmd"; 
    let websocketCarInput;

    function initRobotInputWebSocket() {
      websocketCarInput = new WebSocket(webSocketCarInputUrl);
      websocketCarInput.onopen = function(event) {
        console.log('WebSocket is open now.');
      };
      websocketCarInput.onclose = function(event) {
        console.log('WebSocket is closed now. Reconnecting...');
        setTimeout(initRobotInputWebSocket, 2000);
      };
      websocketCarInput.onmessage = function(event) {
        let data = JSON.parse(event.data).raw;
        console.log('Battery monitor: ${data}%');
      };
    }

    function sendCommand(commandMode) {
      let command = 0;
      command |= (1<<commandMode);
      if (websocketCarInput && websocketCarInput.readyState === WebSocket.OPEN) {
        websocketCarInput.send(JSON.stringify({movementMode: command}));
        console.log('Sent command: ' + command);
      } else {
        console.log('WebSocket is not open. Cannot send command.');
      }
    }

    function sendSpeed(speed) {
      if (websocketCarInput && websocketCarInput.readyState === WebSocket.OPEN) {
        websocketCarInput.send(JSON.stringify({speed: parseFloat(speed)}));
        console.log('Sent speed: ' + speed);
      } else {
        console.log('WebSocket is not open. Cannot send speed.');
      }
    }

    function initSpeedControl() {
      const speedSlider = document.getElementById('speedSlider');
      const speedValue = document.getElementById('speedValue');
      const realtimeToggle = document.getElementById('realtimeToggle');
      
      let lastSentSpeed = speedSlider.value;
      let inputTimeout = null;
      
      // 更新显示值
      speedSlider.addEventListener('input', function() {
        speedValue.textContent = parseFloat(this.value).toFixed(2);
        
        // 如果开启实时发送
        if (realtimeToggle.checked) {
          // 使用节流，避免发送过于频繁
          if (inputTimeout) {
            clearTimeout(inputTimeout);
          }
          inputTimeout = setTimeout(() => {
            if (this.value !== lastSentSpeed) {
              sendSpeed(this.value);
              lastSentSpeed = this.value;
            }
          }, 100); // 100ms节流
        }
      });
      
      // 松开滑块时发送（无论toggle状态如何，都确保发送最终值）
      speedSlider.addEventListener('change', function() {
        if (this.value !== lastSentSpeed) {
          sendSpeed(this.value);
          lastSentSpeed = this.value;
        }
      });
      
      // Toggle状态变化时的提示
      realtimeToggle.addEventListener('change', function() {
        if (this.checked) {
          console.log('实时发送模式已开启');
        } else {
          console.log('松开发送模式已开启');
        }
      });
    }

    // 语言切换功能
    let currentLang = 'zh'; // 默认中文

    const langTexts = {
      pageTitle: { zh: '机器人控制', en: 'Robot Control' },
      langButton: { zh: 'English', en: '中文' },
      speedLabel: { zh: '运动速度控制', en: 'Movement Speed Control' },
      speedText: { zh: '速度', en: 'Speed' },
      slowText: { zh: '慢速', en: 'Slow' },
      mediumText: { zh: '中速', en: 'Medium' },
      fastText: { zh: '快速', en: 'Fast' },
      fastestText: { zh: '最快', en: 'Fastest' },
      releaseMode: { zh: '松开发送', en: 'On Release' },
      realtimeMode: { zh: '实时发送', en: 'Realtime' },
      footerTitle: { zh: '开源项目 · NodeHexa 六足机器人', en: 'Open Source · NodeHexa Hexapod Robot' },
      bilibiliText: { zh: 'B站: 智造师_RoboticsCV', en: 'Bilibili: 智造师_RoboticsCV' },
      githubText: { zh: 'GitHub: ViolinLee', en: 'GitHub: ViolinLee' },
      wechatText: { zh: '公众号: RoboticsCV', en: 'WeChat: RoboticsCV' }
    };

    function toggleLanguage() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      
      // 更新页面标题
      document.getElementById('pageTitle').textContent = langTexts.pageTitle[currentLang];
      
      // 更新语言切换按钮文本
      document.querySelector('.lang-switch').textContent = langTexts.langButton[currentLang];
      
      // 更新速度控制区域文本
      document.querySelector('.speed-label').textContent = langTexts.speedLabel[currentLang];
      document.querySelector('.speed-value').innerHTML = langTexts.speedText[currentLang] + ': <span id="speedValue">' + 
        document.getElementById('speedValue').textContent + '</span>';
      
      // 更新速度标记
      const markers = document.querySelectorAll('.speed-markers span');
      markers[0].textContent = langTexts.slowText[currentLang] + ' (0.3)';
      markers[1].textContent = langTexts.mediumText[currentLang] + ' (0.5)';
      markers[2].textContent = langTexts.fastText[currentLang] + ' (0.75)';
      markers[3].textContent = langTexts.fastestText[currentLang] + ' (1.0)';
      
      // 更新toggle标签
      const toggleLabels = document.querySelectorAll('.toggle-label');
      toggleLabels[0].textContent = langTexts.releaseMode[currentLang];
      toggleLabels[1].textContent = langTexts.realtimeMode[currentLang];
      
      // 更新所有按钮文本
      const buttons = document.querySelectorAll('.button[data-zh][data-en]');
      buttons.forEach(button => {
        button.textContent = button.getAttribute('data-' + currentLang);
      });
      
      // 更新页脚文本
      document.getElementById('footerTitle').textContent = langTexts.footerTitle[currentLang];
      document.getElementById('bilibiliText').textContent = langTexts.bilibiliText[currentLang];
      document.getElementById('githubText').textContent = langTexts.githubText[currentLang];
      document.getElementById('wechatText').textContent = langTexts.wechatText[currentLang];
      
      console.log('Language switched to: ' + (currentLang === 'zh' ? '中文' : 'English'));
    }

    window.onload = function() {
      initRobotInputWebSocket();
      initSpeedControl();
      // 默认显示中文，无需调用toggleLanguage
    };
  </script>
</body>
</html>